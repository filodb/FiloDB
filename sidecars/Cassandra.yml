schemaVersion: 2.0
image: docker://docker.apple.com/rio/aci-cassandra:4.0.0.74
host: CASSANDRA_HOST
ports:
  - name: CASSANDRA_NATIVE_TRANSPORT_PORT
    default: 9042
  - name: CASSANDRA_STORAGE_PORT
    default: 7000
commands:
  # /tmp is a tmpfs, let's exploit it
  - mkdir -p /tmp/cassandra/data /tmp/cassandra/logs /tmp/cassandra/hints
  - ln -sfT /tmp/cassandra/data "$CASSANDRA_HOME/data"
  - ln -sfT /tmp/cassandra/logs "$CASSANDRA_HOME/logs"
  - export CASSANDRA_LOGS=/tmp/cassandra/logs
  - ln -sfT /tmp/cassandra/hints "$CASSANDRA_HOME/hints"
  - chown -R cassandra:cassandra /tmp/cassandra "$CASSANDRA_HOME/data" "$CASSANDRA_HOME/logs"
  # Use this (temporarily) if you get errors about "SimpleStrategy not allowed"
  # Instead you should be configuring your replication strategy to NetworkTopologyStrategy and use a single DC.
  - export JVM_OPTS="-Dcassandra.minimum_replication_factor=1 -Dcassandra.allow_simplestrategy=True"
  - /usr/local/bin/docker-entrypoint.sh cassandra -f